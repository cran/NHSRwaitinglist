<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Three example waiting lists</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Three example waiting lists</h1>



<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(NHSRwaitinglist)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">library</span>(dplyr, <span class="at">warn.conflicts =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="co"># set a seed so that these plots are always the same</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2</span>)</span></code></pre></div>
<p>This vignette is a set of worked examples using a sample dataset
similar to that which you may be working with. It also demonstrates how
to use the <code>wl_*</code> family of functions, such as
<code>wl_simulator</code>, <code>wl_queue_size</code>,
<code>wl_referral_stats</code>, <code>wl_removal_stats</code>, and
<code>wl_stats</code>.</p>
<div id="anatomy-of-a-waiting-list" class="section level2">
<h2>Anatomy of a waiting list</h2>
<p>In its purest form, a waiting list consists of the dates that
individuals arrived in a queue, and the dates that they left having been
seen by the service (doctor, nurse, or diagnostic test, and so on).
These dates are the waiting list additions (or arrivals, referrals), and
waiting list removals (or treatments, discharges). They correspond to
demand (for arrivals), and capacity (for removals).</p>
<p>This vignette is going to simulate 3 different waiting lists:</p>
<ol style="list-style-type: decimal">
<li><a href="#one">A list where demand is higher than capacity</a></li>
<li><a href="#two">A list where demand and capacity are similar</a></li>
<li><a href="#three">A list where there is sufficient capacity for the
demand</a></li>
</ol>
</div>
<div id="one" class="section level2">
<h2>1. A growing waiting list</h2>
<p><a href="#">Back to top…</a></p>
<p>So first we need a waiting list, and we can make a synthetic one
using the <code>wl_simulator()</code> function. We decide how long our
simulation should run for, and what our weekly demand and capacity is.
In the example below the capacity is less than the demand, so over time
we should expect a queue to form.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>waiting_list <span class="ot">&lt;-</span> <span class="fu">wl_simulator</span>(</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>  <span class="at">start_date =</span> <span class="st">&quot;2020-01-01&quot;</span>,</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>  <span class="at">end_date =</span> <span class="st">&quot;2024-03-31&quot;</span>,</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>  <span class="at">demand =</span> <span class="dv">10</span>, <span class="co"># simulating 10 patient arrivals per week</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>  <span class="at">capacity =</span> <span class="dv">9</span> <span class="co"># simulating 9 patients being treated per week</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>)</span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a><span class="fu">head</span>(waiting_list, <span class="dv">10</span>)</span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a><span class="co">#&gt;      Referral    Removal</span></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a><span class="co">#&gt; 1  2020-01-02 2020-01-03</span></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a><span class="co">#&gt; 2  2020-01-03 2020-01-04</span></span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a><span class="co">#&gt; 3  2020-01-04 2020-01-05</span></span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a><span class="co">#&gt; 4  2020-01-04 2020-01-05</span></span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a><span class="co">#&gt; 5  2020-01-06 2020-01-07</span></span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a><span class="co">#&gt; 6  2020-01-08 2020-01-09</span></span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a><span class="co">#&gt; 7  2020-01-08 2020-01-10</span></span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a><span class="co">#&gt; 8  2020-01-08 2020-01-11</span></span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a><span class="co">#&gt; 9  2020-01-09 2020-01-12</span></span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a><span class="co">#&gt; 10 2020-01-09 2020-01-12</span></span></code></pre></div>
<p>Now that we have a waiting list, we should visualise it. We can use
the <code>wl_queue_size()</code> function to tell us the size of the
queue at the end of each day. We can use {ggplot} to make a plot of the
queue size over time, and as expected, it gets larger and larger because
our demand is bigger than our capacity.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="co"># calculate the queue size</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>queue_size <span class="ot">&lt;-</span> <span class="fu">wl_queue_size</span>(waiting_list)</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="fu">head</span>(queue_size)</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="co">#&gt;        dates queue_size</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a><span class="co">#&gt; 1 2020-01-02          1</span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a><span class="co">#&gt; 2 2020-01-03          1</span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a><span class="co">#&gt; 3 2020-01-04          2</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a><span class="co">#&gt; 4 2020-01-05          0</span></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a><span class="co">#&gt; 5 2020-01-06          1</span></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a><span class="co">#&gt; 6 2020-01-07          0</span></span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a><span class="fu">tail</span>(queue_size)</span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a><span class="co">#&gt;           dates queue_size</span></span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a><span class="co">#&gt; 1546 2024-03-26        182</span></span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a><span class="co">#&gt; 1547 2024-03-27        181</span></span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a><span class="co">#&gt; 1548 2024-03-28        183</span></span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a><span class="co">#&gt; 1549 2024-03-29        185</span></span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a><span class="co">#&gt; 1550 2024-03-30        184</span></span>
<span id="cb3-20"><a href="#cb3-20" tabindex="-1"></a><span class="co">#&gt; 1551 2024-03-31        185</span></span>
<span id="cb3-21"><a href="#cb3-21" tabindex="-1"></a></span>
<span id="cb3-22"><a href="#cb3-22" tabindex="-1"></a><span class="co"># visualise the queue with a plot</span></span>
<span id="cb3-23"><a href="#cb3-23" tabindex="-1"></a><span class="fu">ggplot</span>(queue_size, <span class="fu">aes</span>(dates, queue_size)) <span class="sc">+</span></span>
<span id="cb3-24"><a href="#cb3-24" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb3-25"><a href="#cb3-25" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb3-26"><a href="#cb3-26" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;A growing waiting list&quot;</span></span>
<span id="cb3-27"><a href="#cb3-27" tabindex="-1"></a>  )</span></code></pre></div>
<p>![](C:/Users/ChrisMainey(Birmingh/AppData/Local/Temp/RtmpYBoapF/Rbuild198449fb44a8/NHSRwaitinglist/vignettes/three_example_waiting_lists_files/figure-html/unnamed-chunk-3-1.png)<!-- --></p>
<div id="referral-statistics" class="section level3">
<h3>Referral statistics</h3>
<p>Next, we might be interested in some statistics about the referrals,
or arrivals, to the queue. We can use the
<code>wl_referral_stats()</code> function to calculate these.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>referral_stats <span class="ot">&lt;-</span> <span class="fu">wl_referral_stats</span>(waiting_list)</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="fu">head</span>(referral_stats)</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="co">#&gt;   demand_weekly demand_daily demand_cov demand_count</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="co">#&gt; 1      9.818065     1.402581   1.131775         2174</span></span></code></pre></div>
<p>Now we can see that 2174 patients joined our simulated waiting list,
at an average rate of 9.82 per week, or 1.4 per day. Very close to the
10 patients a week we requested when we made our simulated waiting list
using <code>wl_simulator()</code>. The final statistic of interest is
the coefficient of variation, which is 1.13.</p>
</div>
<div id="removal-statistics" class="section level3">
<h3>Removal statistics</h3>
<p>Similarly, we might be interested in some statistics about the
removals from the queue. We can use the <code>wl_removal_stats()</code>
function to calculate these.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>removal_stats <span class="ot">&lt;-</span> <span class="fu">wl_removal_stats</span>(waiting_list)</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="fu">head</span>(removal_stats)</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="co">#&gt;   capacity_weekly capacity_daily capacity_cov removal_count</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="co">#&gt; 1        9.001294       1.285899    0.5363836          1988</span></span></code></pre></div>
<p>Now we can see that 1988 patients were treated and removed from our
simulated waiting list, at an average rate of 9 per week, or 1.29 per
day. Very close to the 9 patients a week we set up using
<code>wl_simulator()</code>. The final statistic of interest is the
coefficient of variation (for removals), which is 0.54.</p>
</div>
<div id="overall-stats" class="section level3">
<h3>Overall stats</h3>
<p>Finally, we can calculate a combined set of statistics to summarise
the waiting list. To do this we need to provide the target waiting time.
This might be 2 weeks for a cancer referral, or commonly 18 weeks for a
standard non-cancer referral.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>overall_stats <span class="ot">&lt;-</span> <span class="fu">wl_stats</span>(</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>  <span class="at">waiting_list =</span> waiting_list,</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>  <span class="at">target_wait =</span> <span class="dv">18</span> <span class="co"># standard NHS 18 weeks target</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>)</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a><span class="fu">head</span>(overall_stats)</span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a><span class="co">#&gt;   mean_demand mean_capacity     load load_too_big count_demand queue_size</span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a><span class="co">#&gt; 1    9.818065      9.001294 1.090739         TRUE         2174        185</span></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a><span class="co">#&gt;   target_queue_size queue_too_big mean_wait cv_arrival cv_removal</span></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a><span class="co">#&gt; 1          44.18129          TRUE  64.63784   1.131775  0.5363836</span></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a><span class="co">#&gt;   target_capacity relief_capacity pressure</span></span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a><span class="co">#&gt; 1              NA        15.23417 7.181982</span></span></code></pre></div>
<p>This gives us a lot of useful information. Taking it step by
step:</p>
<p>The first 4 columns tell us whether the load is larger than 1. If it
is, we can expect the queue to continue growing indefinitely.</p>
<table>
<thead>
<tr class="header">
<th align="center">mean_demand</th>
<th align="center">mean_capacity</th>
<th align="center">load</th>
<th align="center">load_too_big</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">9.818065</td>
<td align="center">9.001294</td>
<td align="center">1.090739</td>
<td align="center">TRUE</td>
</tr>
</tbody>
</table>
<p>The next columns tell us about the resulting queue size at the end of
our simulation, the target size we need to plan for in order to achieve
the 18 week waiting target, and a judgement about whether the queue is
too large. If the queue is too large, we need to implement some relief
capacity to bring it within range before attempting to maintain the
queue.</p>
<table>
<thead>
<tr class="header">
<th align="center">queue_size</th>
<th align="center">target_queue_size</th>
<th align="center">queue_too_big</th>
<th align="center">mean_wait</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">185</td>
<td align="center">44.18129</td>
<td align="center">TRUE</td>
<td align="center">64.63784</td>
</tr>
</tbody>
</table>
<p>There is a column to report the actual average patient waiting time,
which is 64.64 weeks, compared to our target of 18 weeks.</p>
<table>
<thead>
<tr class="header">
<th align="center">mean_wait</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">64.63784</td>
</tr>
</tbody>
</table>
<p>These two columns re-state the coefficients of variance for use in
reporting.</p>
<table>
<thead>
<tr class="header">
<th align="center">cv_arrival</th>
<th align="center">cv_removal</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">1.131775</td>
<td align="center">0.5363836</td>
</tr>
</tbody>
</table>
<p>The next two columns tell us about the required capacity. Only one
will contain data.</p>
<ol style="list-style-type: decimal">
<li>If the queue is not too large, <code>&quot;target_capacity&quot;</code> will
report the capacity required to maintain the queue at it’s target
waiting time performance.</li>
<li>If the queue is too large, <code>&quot;relief_capacity&quot;</code> will
report the capacity required to bring the queue to a maintainable size
within 26 weeks (6 months).</li>
</ol>
<table>
<thead>
<tr class="header">
<th align="center">target_capacity</th>
<th align="center">relief_capacity</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">NA</td>
<td align="center">15.23417</td>
</tr>
</tbody>
</table>
<p>The final column reports the waiting list <code>&quot;pressure&quot;</code>.
This will be useful later when comparing waiting lists of differing
sizes, with differing targets. It allows waiting list pressures to be
compared because the waiting list with the largest number of patients
waiting is not always the list with the largest problem meeting its
target.</p>
<table>
<thead>
<tr class="header">
<th align="center">pressure</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">7.181982</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="two" class="section level2">
<h2>2. A finely balanced waiting list</h2>
<p><a href="#">Back to top…</a></p>
<p>The waiting list in this section is very finely balanced. The demand
remains the same as the last example, but now capacity has been
increased to be slightly larger than demand. It is not significantly
larger (there is approximately 2% <code>&quot;spare&quot;</code>).</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>waiting_list <span class="ot">&lt;-</span> <span class="fu">wl_simulator</span>(</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>  <span class="at">start_date =</span> <span class="st">&quot;2020-01-01&quot;</span>,</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>  <span class="at">end_date =</span> <span class="st">&quot;2024-03-31&quot;</span>,</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>  <span class="at">demand =</span> <span class="dv">10</span>, <span class="co"># simulating 10 patient arrivals per week</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>  <span class="at">capacity =</span> <span class="fl">10.2</span> <span class="co"># simulating 10.2 patients being treated per week</span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>)</span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a>referral_stats <span class="ot">&lt;-</span> <span class="fu">wl_referral_stats</span>(waiting_list)</span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a><span class="fu">head</span>(referral_stats)</span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a><span class="co">#&gt;   demand_weekly demand_daily demand_cov demand_count</span></span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a><span class="co">#&gt; 1      10.10458     1.443512   1.153809         2236</span></span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a></span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a>removal_stats <span class="ot">&lt;-</span> <span class="fu">wl_removal_stats</span>(waiting_list)</span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a><span class="fu">head</span>(removal_stats)</span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a><span class="co">#&gt;   capacity_weekly capacity_daily capacity_cov removal_count</span></span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a><span class="co">#&gt; 1        10.12941       1.447059    0.6896719          2214</span></span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a></span>
<span id="cb7-18"><a href="#cb7-18" tabindex="-1"></a><span class="co"># calculate the queue size</span></span>
<span id="cb7-19"><a href="#cb7-19" tabindex="-1"></a>queue_size <span class="ot">&lt;-</span> <span class="fu">wl_queue_size</span>(waiting_list)</span></code></pre></div>
<p>This time we processed 2214 patients.</p>
<p>The increase in capacity not only allowed processing more patients,
it also changed the shape of the queue. Visualising the queue we can see
that this time it did not grow uncontrollably, reaching a maximum size
of 35 patients waiting over the same time period as the first
simulation. It also returned to zero length several times during the
simulated period.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="co"># visualise the queue with a plot</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="fu">ggplot</span>(queue_size, <span class="fu">aes</span>(dates, queue_size)) <span class="sc">+</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;A finely-balanced waiting list&quot;</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>  )</span></code></pre></div>
<p>![](C:/Users/ChrisMainey(Birmingh/AppData/Local/Temp/RtmpYBoapF/Rbuild198449fb44a8/NHSRwaitinglist/vignettes/three_example_waiting_lists_files/figure-html/unnamed-chunk-14-1.png)<!-- --></p>
<p>This time we will go straight to calculating the overall
statistics.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>overall_stats <span class="ot">&lt;-</span> <span class="fu">wl_stats</span>(</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>  <span class="at">waiting_list =</span> waiting_list,</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>  <span class="at">target_wait =</span> <span class="dv">18</span> <span class="co"># standard NHS 18wk target</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>)</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a><span class="fu">head</span>(overall_stats)</span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a><span class="co">#&gt;   mean_demand mean_capacity      load load_too_big count_demand queue_size</span></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a><span class="co">#&gt; 1    10.10458      10.12941 0.9975489        FALSE         2236         22</span></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a><span class="co">#&gt;   target_queue_size queue_too_big mean_wait cv_arrival cv_removal</span></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a><span class="co">#&gt; 1          45.47063         FALSE  6.863636   1.153809  0.6896719</span></span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a><span class="co">#&gt;   target_capacity relief_capacity  pressure</span></span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a><span class="co">#&gt; 1        10.30535              NA 0.7626263</span></span></code></pre></div>
<p>In this finely balanced example, the mean demand and mean capacity
give a load very close to 1, at 0.9975. While this is less than one, it
is perhaps a little too close for comfort.</p>
<p>We can see that the finishing queue size is 22, but as discussed
above, the waiting list fluctuated in size, and even returned to zero a
couple of times during the simulated period. It has not grown
uncontrollably as in the first example.</p>
<p>The mean wait is 6.86, which is less than the target of 18 weeks, but
is more than a quarter of the target. The exponential shape of waiting
list distributions means that in this system we would expect more than a
reasonable number of patients to be experiencing waiting times of over
18 weeks.</p>
<p>This time, we do not need relief capacity because the queue is not
too big. Instead, the package recommends a
<code>&quot;target capacity&quot;</code>, which we need to provide if we want to
meet the 18 week standard for the right proportion of patients. In this
case it is 10.305, which is only very marginally larger than the mean
capacity we have available (10.129).</p>
</div>
<div id="three" class="section level2">
<h2>3. A waiting list with sufficient capacity</h2>
<p><a href="#">Back to top…</a></p>
<p>The final example is for a waiting list with sufficient capacity to
meet demand. We’ll use the recommended figure from the example above,
assuming we have made some improvements and increased available capacity
from 10.2 to 10.3 patients per week.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>waiting_list <span class="ot">&lt;-</span> <span class="fu">wl_simulator</span>(</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>  <span class="at">start_date =</span> <span class="st">&quot;2020-01-01&quot;</span>,</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>  <span class="at">end_date =</span> <span class="st">&quot;2024-03-31&quot;</span>,</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>  <span class="at">demand =</span> <span class="dv">10</span>, <span class="co"># simulating 10 patient arrivals per week</span></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>  <span class="at">capacity =</span> <span class="fl">10.3</span> <span class="co"># simulating 10.3 patients being treated per week</span></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>)</span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a>referral_stats <span class="ot">&lt;-</span> <span class="fu">wl_referral_stats</span>(waiting_list)</span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a><span class="fu">head</span>(referral_stats)</span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a><span class="co">#&gt;   demand_weekly demand_daily demand_cov demand_count</span></span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a><span class="co">#&gt; 1      9.698904     1.385558   1.173034         2149</span></span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a>removal_stats <span class="ot">&lt;-</span> <span class="fu">wl_removal_stats</span>(waiting_list)</span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a><span class="fu">head</span>(removal_stats)</span>
<span id="cb10-15"><a href="#cb10-15" tabindex="-1"></a><span class="co">#&gt;   capacity_weekly capacity_daily capacity_cov removal_count</span></span>
<span id="cb10-16"><a href="#cb10-16" tabindex="-1"></a><span class="co">#&gt; 1        10.14005       1.448579    0.7247564          2141</span></span>
<span id="cb10-17"><a href="#cb10-17" tabindex="-1"></a></span>
<span id="cb10-18"><a href="#cb10-18" tabindex="-1"></a><span class="co"># calculate the queue size</span></span>
<span id="cb10-19"><a href="#cb10-19" tabindex="-1"></a>queue_size <span class="ot">&lt;-</span> <span class="fu">wl_queue_size</span>(waiting_list)</span></code></pre></div>
<p>This time we processed 2141 patients.<br />
Visualising the queue, again it looks different to the previous
examples. While the maximum number of patients in the queue is similar
to the last example, this time the queue size has frequently dropped to
zero. This is a stable queue, which is able to empty more regularly.</p>
<p><strong>NOTE</strong> When the queue is empty, the process serving it
will also be idle. Conventional wisdom has it that at this point the
process must have excess capacity, which can safely be removed. This is
<strong>not</strong> the case. Returning to “Fact 2” of <a href="https://www.medrxiv.org/content/10.1101/2022.08.23.22279117v1.full">Professor
Neil Walton’s white paper</a>,</p>
<blockquote>
<p>If you want to have low waiting times, then there must be a
non-negligible fraction of time where services are not being used.</p>
</blockquote>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="co"># visualise the queue with a plot</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="fu">ggplot</span>(queue_size, <span class="fu">aes</span>(dates, queue_size)) <span class="sc">+</span></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;A stable waiting list&quot;</span></span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a>  )</span></code></pre></div>
<p>![](C:/Users/ChrisMainey(Birmingh/AppData/Local/Temp/RtmpYBoapF/Rbuild198449fb44a8/NHSRwaitinglist/vignettes/three_example_waiting_lists_files/figure-html/unnamed-chunk-17-1.png)<!-- --></p>
<p>Again calculating the overall statistics.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>overall_stats <span class="ot">&lt;-</span> <span class="fu">wl_stats</span>(</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>  <span class="at">waiting_list =</span> waiting_list,</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>  <span class="at">target_wait =</span> <span class="dv">18</span> <span class="co"># standard NHS 18 weeks target</span></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>)</span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a><span class="fu">head</span>(overall_stats)</span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a><span class="co">#&gt;   mean_demand mean_capacity      load load_too_big count_demand queue_size</span></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a><span class="co">#&gt; 1    9.698904      10.14005 0.9564943        FALSE         2149          7</span></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a><span class="co">#&gt;   target_queue_size queue_too_big mean_wait cv_arrival cv_removal</span></span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a><span class="co">#&gt; 1          43.64507         FALSE 0.8571429   1.173034  0.7247564</span></span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a><span class="co">#&gt;   target_capacity relief_capacity  pressure</span></span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a><span class="co">#&gt; 1        9.910157              NA 0.0952381</span></span></code></pre></div>
<p>This time the simulation has created a mean demand and capacity which
is slightly lower than we asked for, but the gap between them is similar
to what we wanted.</p>
<p>The load comes out at 0.956, which is more comfortably below one. A
still lower load would give more headroom, and may even become necessary
if the variability of demand or capacity were to increase.</p>
<p>The mean wait is 0.86, less than a week, which is very comfortably
less than the target of 18 weeks. In this system we expect the 18 weeks
target to be met for the vast majority of patients.</p>
<p>Again, the package is recommending a <code>&quot;target capacity&quot;</code>,
this time of 9.91, which is a similar margin above the mean demand for
this simulation (9.699).</p>
</div>
<div id="conclusion" class="section level2">
<h2>Conclusion</h2>
<p><a href="#">Back to top…</a></p>
<p>This vignette has detailed some of the <code>wl_*</code> functions
you can use to explore your waiting list performance. We also saw how
altering service capacity without changing demand can have a dramatic
effect on the behaviour of a waiting list.</p>
<hr />
<p>END</p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
